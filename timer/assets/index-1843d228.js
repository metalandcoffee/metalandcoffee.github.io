var ve=Object.defineProperty;var we=(e,t,s)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var N=(e,t,s)=>(we(e,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();function Y(e){"@babel/helpers - typeof";return Y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(e)}function I(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function k(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function C(e){k(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Y(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function ye(e,t){k(2,arguments);var s=C(e),i=I(t);return isNaN(i)?new Date(NaN):(i&&s.setDate(s.getDate()+i),s)}function Ce(e,t){k(2,arguments);var s=C(e),i=I(t);if(isNaN(i))return new Date(NaN);if(!i)return s;var n=s.getDate(),a=new Date(s.getTime());a.setMonth(s.getMonth()+i+1,0);var m=a.getDate();return n>=m?a:(s.setFullYear(a.getFullYear(),a.getMonth(),n),s)}function j(e,t){if(k(2,arguments),!t||Y(t)!=="object")return new Date(NaN);var s=t.years?I(t.years):0,i=t.months?I(t.months):0,n=t.weeks?I(t.weeks):0,a=t.days?I(t.days):0,m=t.hours?I(t.hours):0,g=t.minutes?I(t.minutes):0,b=t.seconds?I(t.seconds):0,x=C(e),h=i||s?Ce(x,i+s*12):x,H=a||n?ye(h,a+n*7):h,v=g+m*60,w=b+v*60,r=w*1e3,o=new Date(H.getTime()+r);return o}function de(e,t){k(2,arguments);var s=C(e).getTime(),i=I(t);return new Date(s+i)}function Q(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function X(e){k(1,arguments);var t=C(e);return t.setHours(0,0,0,0),t}var ke=864e5;function Te(e,t){k(2,arguments);var s=X(e),i=X(t),n=s.getTime()-Q(s),a=i.getTime()-Q(i);return Math.round((n-a)/ke)}var Me=6e4;function Ee(e,t){k(2,arguments);var s=I(t);return de(e,s*Me)}function $e(e,t){k(2,arguments);var s=I(t);return de(e,s*1e3)}function P(e,t){k(2,arguments);var s=C(e),i=C(t),n=s.getTime()-i.getTime();return n<0?-1:n>0?1:n}var Se=6e4,Le=36e5;function Ie(e,t){k(2,arguments);var s=C(e),i=C(t),n=s.getFullYear()-i.getFullYear(),a=s.getMonth()-i.getMonth();return n*12+a}function xe(e,t){k(2,arguments);var s=C(e),i=C(t);return s.getFullYear()-i.getFullYear()}function K(e,t){var s=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return s<0?-1:s>0?1:s}function Oe(e,t){k(2,arguments);var s=C(e),i=C(t),n=K(s,i),a=Math.abs(Te(s,i));s.setDate(s.getDate()-n*a);var m=+(K(s,i)===-n),g=n*(a-m);return g===0?0:g}function z(e,t){return k(2,arguments),C(e).getTime()-C(t).getTime()}var Z={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},Ne="trunc";function B(e){return e?Z[e]:Z[Ne]}function De(e,t,s){k(2,arguments);var i=z(e,t)/Le;return B(s==null?void 0:s.roundingMethod)(i)}function Re(e,t,s){k(2,arguments);var i=z(e,t)/Se;return B(s==null?void 0:s.roundingMethod)(i)}function Ae(e){k(1,arguments);var t=C(e);return t.setHours(23,59,59,999),t}function Pe(e){k(1,arguments);var t=C(e),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(23,59,59,999),t}function je(e){k(1,arguments);var t=C(e);return Ae(t).getTime()===Pe(t).getTime()}function Ue(e,t){k(2,arguments);var s=C(e),i=C(t),n=P(s,i),a=Math.abs(Ie(s,i)),m;if(a<1)m=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-n*a);var g=P(s,i)===-n;je(C(e))&&a===1&&P(e,i)===1&&(g=!1),m=n*(a-Number(g))}return m===0?0:m}function Fe(e,t,s){k(2,arguments);var i=z(e,t)/1e3;return B(s==null?void 0:s.roundingMethod)(i)}function He(e,t){k(2,arguments);var s=C(e),i=C(t),n=P(s,i),a=Math.abs(xe(s,i));s.setFullYear(1584),i.setFullYear(1584);var m=P(s,i)===-n,g=n*(a-Number(m));return g===0?0:g}function Je(e){k(1,arguments);var t=C(e.start),s=C(e.end);if(isNaN(t.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(s.getTime()))throw new RangeError("End Date is invalid");var i={};i.years=Math.abs(He(s,t));var n=P(s,t),a=j(t,{years:n*i.years});i.months=Math.abs(Ue(s,a));var m=j(a,{months:n*i.months});i.days=Math.abs(Oe(s,m));var g=j(m,{days:n*i.days});i.hours=Math.abs(De(s,g));var b=j(g,{hours:n*i.hours});i.minutes=Math.abs(Re(s,b));var x=j(b,{minutes:n*i.minutes});return i.seconds=Math.abs(Fe(s,x)),i}function ee(e,t){k(2,arguments);var s=C(e),i=I(t);return s.setMilliseconds(i),s}class Ye{constructor(t,s){N(this,"minutesLimit");N(this,"secondsLimit");N(this,"timerId");N(this,"minsEl");N(this,"secsEl");this.minutesLimit=t,this.secondsLimit=s,this.timerId=0,this.minsEl=document.getElementById("minutes"),this.secsEl=document.getElementById("seconds"),this.init()}init(){this.minsEl.innerText=this.minutesLimit.toString().padStart(2,"0"),this.secsEl.innerText=this.secondsLimit.toString().padStart(2,"0")}start(){let t=new Date;t=ee(t,0);let s=Ee(t,this.minutesLimit);s=$e(s,this.secondsLimit),this.timerId=setInterval(this.countdown.bind(this),1e3,s)}countdown(t){let s=new Date;s=ee(s,0);const i=Je({start:s,end:t}),n=i.minutes,a=i.seconds;this.minsEl.innerText=n.toString().padStart(2,"0"),this.secsEl.innerText=a.toString().padStart(2,"0"),!i.minutes&&!i.seconds&&(new Audio("alarm.wav").play(),clearInterval(this.timerId))}pause(){clearInterval(this.timerId),this.minsEl.value=this.minutesLimit.toString().padStart(2,"0"),this.secsEl.value=this.secondsLimit.toString().padStart(2,"0")}stop(){clearInterval(this.timerId),this.minsEl.innerText=this.minutesLimit.toString().padStart(2,"0"),this.secsEl.innerText=this.secondsLimit.toString().padStart(2,"0")}}var te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ge(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function We(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var s=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(s,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),s}var pe={exports:{}};const qe={},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"})),V=We(Ve);var ge={exports:{}};const ze=/^\u0001ACTION ([^\u0001]+)\u0001$/,Be=/^(justinfan)(\d+$)/,Qe=/\\([sn:r\\])/g,Xe=/([ \n;\r\\])/g,se={s:" ",n:"",":":";",r:""},ie={" ":"s","\n":"n",";":":","\r":"r"},Ke=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),Ze=/[|\\^$*+?:#]/,J=ge.exports={get:(e,t)=>typeof e>"u"?t:e,hasOwn:(e,t)=>({}).hasOwnProperty.call(e,t),promiseDelay:e=>new Promise(t=>setTimeout(t,e)),isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),toNumber(e,t){if(e===null)return 0;const s=Math.pow(10,J.isFinite(t)?t:0);return Math.round(e*s)/s},isInteger:e=>!isNaN(J.toNumber(e,0)),isRegex:e=>Ze.test(e),isURL:e=>Ke.test(e),justinfan:()=>`justinfan${Math.floor(Math.random()*8e4+1e3)}`,isJustinfan:e=>Be.test(e),channel(e){const t=(e||"").toLowerCase();return t[0]==="#"?t:"#"+t},username(e){const t=(e||"").toLowerCase();return t[0]==="#"?t.slice(1):t},token:e=>e?e.toLowerCase().replace("oauth:",""):"",password(e){const t=J.token(e);return t?`oauth:${t}`:""},actionMessage:e=>e.match(ze),replaceAll(e,t){if(e===null||typeof e>"u")return null;for(const s in t)e=e.replace(new RegExp(s,"g"),t[s]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC(e){return!e||typeof e!="string"||!e.includes("\\")?e:e.replace(Qe,(t,s)=>s in se?se[s]:s)},escapeIRC(e){return!e||typeof e!="string"?e:e.replace(Xe,(t,s)=>s in ie?`\\${ie[s]}`:s)},addWord:(e,t)=>e.length?e+" "+t:e+t,splitLine(e,t){let s=e.substring(0,t).lastIndexOf(" ");return s===-1&&(s=t-1),[e.substring(0,s),e.substring(s+1)]},extractNumber(e){const t=e.split(" ");for(let s=0;s<t.length;s++)if(J.isInteger(t[s]))return~~t[s];return 0},formatDate(e){let t=e.getHours(),s=e.getMinutes();return t=(t<10?"0":"")+t,s=(s<10?"0":"")+s,`${t}:${s}`},inherits(e,t){e.super_=t;const s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e},isNode(){try{return typeof process=="object"&&Object.prototype.toString.call(process)==="[object process]"}catch{}return!1}};var F=ge.exports;const et=V,ne=F;var tt=function(t,s){let i=t.url!==void 0?t.url:t.uri;if(ne.isURL(i)||(i=`https://api.twitch.tv/kraken${i[0]==="/"?i:`/${i}`}`),ne.isNode()){const n=Object.assign({method:"GET",json:!0},t);if(n.qs){const b=new URLSearchParams(n.qs);i+=`?${b}`}const a={};"fetchAgent"in this.opts.connection&&(a.agent=this.opts.connection.fetchAgent);const m=et(i,{...a,method:n.method,headers:n.headers,body:n.body});let g={};m.then(b=>(g={statusCode:b.status,headers:b.headers},n.json?b.json():b.text())).then(b=>s(null,g,b),b=>s(b,g,null))}else{const n=Object.assign({method:"GET",headers:{}},t,{url:i}),a=new XMLHttpRequest;a.open(n.method,n.url,!0);for(const m in n.headers)a.setRequestHeader(m,n.headers[m]);a.responseType="json",a.addEventListener("load",m=>{a.readyState===4&&(a.status!==200?s(a.status,null,null):s(null,null,a.response))}),a.send()}};const f=F;function oe(e,t){return e=f.channel(e),t=f.get(t,30),this._sendCommand(null,e,`/followers ${t}`,(s,i)=>{this.once("_promiseFollowers",n=>{n?i(n):s([e,~~t])})})}function re(e){return e=f.channel(e),this._sendCommand(null,e,"/followersoff",(t,s)=>{this.once("_promiseFollowersoff",i=>{i?s(i):t([e])})})}function ae(e){return e=f.channel(e),this._sendCommand(null,null,`PART ${e}`,(t,s)=>{this.once("_promisePart",i=>{i?s(i):t([e])})})}function ce(e){return e=f.channel(e),this._sendCommand(null,e,"/r9kbeta",(t,s)=>{this.once("_promiseR9kbeta",i=>{i?s(i):t([e])})})}function le(e){return e=f.channel(e),this._sendCommand(null,e,"/r9kbetaoff",(t,s)=>{this.once("_promiseR9kbetaoff",i=>{i?s(i):t([e])})})}function he(e,t){return e=f.channel(e),t=f.get(t,300),this._sendCommand(null,e,`/slow ${t}`,(s,i)=>{this.once("_promiseSlow",n=>{n?i(n):s([e,~~t])})})}function ue(e){return e=f.channel(e),this._sendCommand(null,e,"/slowoff",(t,s)=>{this.once("_promiseSlowoff",i=>{i?s(i):t([e])})})}var st={action(e,t){return e=f.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,(s,i)=>{s([e,t])})},ban(e,t,s){return e=f.channel(e),t=f.username(t),s=f.get(s,""),this._sendCommand(null,e,`/ban ${t} ${s}`,(i,n)=>{this.once("_promiseBan",a=>{a?n(a):i([e,t,s])})})},clear(e){return e=f.channel(e),this._sendCommand(null,e,"/clear",(t,s)=>{this.once("_promiseClear",i=>{i?s(i):t([e])})})},color(e,t){return t=f.get(t,e),this._sendCommand(null,"#tmijs",`/color ${t}`,(s,i)=>{this.once("_promiseColor",n=>{n?i(n):s([t])})})},commercial(e,t){return e=f.channel(e),t=f.get(t,30),this._sendCommand(null,e,`/commercial ${t}`,(s,i)=>{this.once("_promiseCommercial",n=>{n?i(n):s([e,~~t])})})},deletemessage(e,t){return e=f.channel(e),this._sendCommand(null,e,`/delete ${t}`,(s,i)=>{this.once("_promiseDeletemessage",n=>{n?i(n):s([e])})})},emoteonly(e){return e=f.channel(e),this._sendCommand(null,e,"/emoteonly",(t,s)=>{this.once("_promiseEmoteonly",i=>{i?s(i):t([e])})})},emoteonlyoff(e){return e=f.channel(e),this._sendCommand(null,e,"/emoteonlyoff",(t,s)=>{this.once("_promiseEmoteonlyoff",i=>{i?s(i):t([e])})})},followersonly:oe,followersmode:oe,followersonlyoff:re,followersmodeoff:re,host(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(2e3,e,`/host ${t}`,(s,i)=>{this.once("_promiseHost",(n,a)=>{n?i(n):s([e,t,~~a])})})},join(e){return e=f.channel(e),this._sendCommand(void 0,null,`JOIN ${e}`,(t,s)=>{const i="_promiseJoin";let n=!1;const a=(g,b)=>{e===f.channel(b)&&(this.removeListener(i,a),n=!0,g?s(g):t([e]))};this.on(i,a);const m=this._getPromiseDelay();f.promiseDelay(m).then(()=>{n||this.emit(i,"No response from Twitch.",e)})})},mod(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(null,e,`/mod ${t}`,(s,i)=>{this.once("_promiseMod",n=>{n?i(n):s([e,t])})})},mods(e){return e=f.channel(e),this._sendCommand(null,e,"/mods",(t,s)=>{this.once("_promiseMods",(i,n)=>{i?s(i):(n.forEach(a=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(a)||this.moderators[e].push(a)}),t(n))})})},part:ae,leave:ae,ping(){return this._sendCommand(null,null,"PING",(e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},f.get(this.opts.connection.timeout,9999)),this.once("_promisePing",s=>e([parseFloat(s)]))})},r9kbeta:ce,r9kmode:ce,r9kbetaoff:le,r9kmodeoff:le,raw(e){return this._sendCommand(null,null,e,(t,s)=>{t([e])})},say(e,t){return e=f.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?t.substr(1,3)==="me "?this.action(e,t.substr(4)):this._sendCommand(null,e,t,(s,i)=>{s([e,t])}):this._sendMessage(this._getPromiseDelay(),e,t,(s,i)=>{s([e,t])})},slow:he,slowmode:he,slowoff:ue,slowmodeoff:ue,subscribers(e){return e=f.channel(e),this._sendCommand(null,e,"/subscribers",(t,s)=>{this.once("_promiseSubscribers",i=>{i?s(i):t([e])})})},subscribersoff(e){return e=f.channel(e),this._sendCommand(null,e,"/subscribersoff",(t,s)=>{this.once("_promiseSubscribersoff",i=>{i?s(i):t([e])})})},timeout(e,t,s,i){return e=f.channel(e),t=f.username(t),s!==null&&!f.isInteger(s)&&(i=s,s=300),s=f.get(s,300),i=f.get(i,""),this._sendCommand(null,e,`/timeout ${t} ${s} ${i}`,(n,a)=>{this.once("_promiseTimeout",m=>{m?a(m):n([e,t,~~s,i])})})},unban(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(null,e,`/unban ${t}`,(s,i)=>{this.once("_promiseUnban",n=>{n?i(n):s([e,t])})})},unhost(e){return e=f.channel(e),this._sendCommand(2e3,e,"/unhost",(t,s)=>{this.once("_promiseUnhost",i=>{i?s(i):t([e])})})},unmod(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(null,e,`/unmod ${t}`,(s,i)=>{this.once("_promiseUnmod",n=>{n?i(n):s([e,t])})})},unvip(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(null,e,`/unvip ${t}`,(s,i)=>{this.once("_promiseUnvip",n=>{n?i(n):s([e,t])})})},vip(e,t){return e=f.channel(e),t=f.username(t),this._sendCommand(null,e,`/vip ${t}`,(s,i)=>{this.once("_promiseVip",n=>{n?i(n):s([e,t])})})},vips(e){return e=f.channel(e),this._sendCommand(null,e,"/vips",(t,s)=>{this.once("_promiseVips",(i,n)=>{i?s(i):t(n)})})},whisper(e,t){return e=f.username(e),e===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs",`/w ${e} ${t}`,(s,i)=>{this.once("_promiseWhisper",n=>{n&&i(n)})}).catch(s=>{if(s&&typeof s=="string"&&s.indexOf("No response from Twitch.")!==0)throw s;const i=f.channel(e),n=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);return this.emits(["whisper","message"],[[i,n,t,!0],[i,n,t,!0]]),[e,t]})}};function $(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var it=$;$.EventEmitter=$;$.prototype._events=void 0;$.prototype._maxListeners=void 0;$.defaultMaxListeners=10;$.prototype.setMaxListeners=function(e){if(!nt(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this};$.prototype.emit=function(e){var t,s,i,n,a,m;if(this._events||(this._events={}),e==="error"&&(!this._events.error||U(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(s=this._events[e],_e(s))return!1;if(O(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),s.apply(this,n)}else if(U(s))for(n=Array.prototype.slice.call(arguments,1),m=s.slice(),i=m.length,a=0;a<i;a++)m[a].apply(this,n);return!0};$.prototype.addListener=function(e,t){var s;if(!O(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,O(t.listener)?t.listener:t),this._events[e]?U(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,U(this._events[e])&&!this._events[e].warned&&(_e(this._maxListeners)?s=$.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())),this};$.prototype.on=$.prototype.addListener;$.prototype.once=function(e,t){if(!O(t))throw TypeError("listener must be a function");var s=!1;if(this._events.hasOwnProperty(e)&&e.charAt(0)==="_"){var i=1,n=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(n)&&i++;e=e+i}function m(){e.charAt(0)==="_"&&!isNaN(e.substr(e.length-1))&&(e=e.substring(0,e.length-1)),this.removeListener(e,m),s||(s=!0,t.apply(this,arguments))}return m.listener=t,this.on(e,m),this};$.prototype.removeListener=function(e,t){var s,i,n,a;if(!O(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],n=s.length,i=-1,s===t||O(s.listener)&&s.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&e.charAt(0)==="_"){var m=e;for(var g in this._events)this._events.hasOwnProperty(g)&&g.startsWith(m)&&(isNaN(parseInt(g.substr(g.length-1)))||(this._events[e+parseInt(g.substr(g.length-1)-1)]=this._events[g],delete this._events[g]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(U(s)){for(a=n;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){i=a;break}if(i<0)return this;s.length===1?(s.length=0,delete this._events[e]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this};$.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events)t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],O(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this};$.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:O(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t};$.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(O(t))return 1;if(t)return t.length}return 0};$.listenerCount=function(e,t){return e.listenerCount(t)};function O(e){return typeof e=="function"}function nt(e){return typeof e=="number"}function U(e){return typeof e=="object"&&e!==null}function _e(e){return e===void 0}const ot=F;let be="info";const me={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function R(e){return function(t){me[e]>=me[be]&&console.log(`[${ot.formatDate(new Date)}] ${e}: ${t}`)}}var rt={setLevel(e){be=e},trace:R("trace"),debug:R("debug"),info:R("info"),warn:R("warn"),error:R("error"),fatal:R("fatal")};const W=F,A=/\S+/g;function q(e,t,s=",",i="/",n){const a=e[t];if(a===void 0)return e;const m=typeof a=="string";if(e[t+"-raw"]=m?a:null,a===!0)return e[t]=null,e;if(e[t]={},m){const g=a.split(s);for(let b=0;b<g.length;b++){const x=g[b].split(i);let h=x[1];n!==void 0&&h&&(h=h.split(n)),e[t][x[0]]=h||null}}return e}var at={badges:e=>q(e,"badges"),badgeInfo:e=>q(e,"badge-info"),emotes:e=>q(e,"emotes","/",":",","),emoteRegex(e,t,s,i){A.lastIndex=0;const n=new RegExp("(\\b|^|\\s)"+W.unescapeHtml(t)+"(\\b|$|\\s)");let a;for(;(a=A.exec(e))!==null;)n.test(a[0])&&(i[s]=i[s]||[],i[s].push([a.index,A.lastIndex-1]))},emoteString(e,t,s,i){A.lastIndex=0;let n;for(;(n=A.exec(e))!==null;)n[0]===W.unescapeHtml(t)&&(i[s]=i[s]||[],i[s].push([n.index,A.lastIndex-1]))},transformEmotes(e){let t="";return Object.keys(e).forEach(s=>{t=`${t+s}:`,e[s].forEach(i=>t=`${t+i.join("-")},`),t=`${t.slice(0,-1)}/`}),t.slice(0,-1)},formTags(e){const t=[];for(const s in e){const i=W.escapeIRC(e[s]);t.push(`${s}=${i}`)}return`@${t.join(";")}`},msg(e){const t={raw:e,tags:{},prefix:null,command:null,params:[]};let s=0,i=0;if(e.charCodeAt(0)===64){if(i=e.indexOf(" "),i===-1)return null;const n=e.slice(1,i).split(";");for(let a=0;a<n.length;a++){const m=n[a],g=m.split("=");t.tags[g[0]]=m.substring(m.indexOf("=")+1)||!0}s=i+1}for(;e.charCodeAt(s)===32;)s++;if(e.charCodeAt(s)===58){if(i=e.indexOf(" ",s),i===-1)return null;for(t.prefix=e.slice(s+1,i),s=i+1;e.charCodeAt(s)===32;)s++}if(i=e.indexOf(" ",s),i===-1)return e.length>s?(t.command=e.slice(s),t):null;for(t.command=e.slice(s,i),s=i+1;e.charCodeAt(s)===32;)s++;for(;s<e.length;){if(i=e.indexOf(" ",s),e.charCodeAt(s)===58){t.params.push(e.slice(s+1));break}if(i!==-1){for(t.params.push(e.slice(s,i)),s=i+1;e.charCodeAt(s)===32;)s++;continue}if(i===-1){t.params.push(e.slice(s));break}}return t}};class ct{constructor(t){this.queue=[],this.index=0,this.defaultDelay=t===void 0?3e3:t}add(t,s){this.queue.push({fn:t,delay:s})}next(){const t=this.index++,s=this.queue[t];if(!s)return;const i=this.queue[this.index];if(s.fn(),i){const n=i.delay===void 0?this.defaultDelay:i.delay;setTimeout(()=>this.next(),n)}}}var lt=ct;(function(e){const t=typeof te<"u"?te:typeof window<"u"?window:{},s=t.WebSocket||V,i=t.fetch||V,n=tt,a=st,m=it.EventEmitter,g=rt,b=at,x=lt,h=F;let H=!1;const v=function w(r){if(!(this instanceof w))return new w(r);this.opts=h.get(r,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=h.get(this.opts.options.clientId,null),this._globalDefaultChannel=h.channel(h.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=h.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=h.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=h.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=h.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=h.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=h.get(this.opts.connection.reconnect,!0),this.reconnectDecay=h.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=h.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=h.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;let o="error";this.opts.options.debug&&(o="info"),this.log=this.opts.logger||g;try{g.setLevel(o)}catch{}this.opts.channels.forEach((c,_,d)=>d[_]=h.channel(c)),m.call(this),this.setMaxListeners(0)};h.inherits(v,m);for(const w in a)v.prototype[w]=a[w];v.prototype.emits=function(r,o){for(let c=0;c<r.length;c++){const _=c<o.length?o[c]:o[o.length-1];this.emit.apply(this,[r[c]].concat(_))}},v.prototype.api=function(...w){H||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),H=!0),n(...w)},v.prototype.handleMessage=function(r){if(!r)return;this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(r)),r);const o=h.channel(h.get(r.params[0],null));let c=h.get(r.params[1],null);const _=h.get(r.tags["msg-id"],null),d=r.tags=b.badges(b.badgeInfo(b.emotes(r.tags)));for(const l in d){if(l==="emote-sets"||l==="ban-duration"||l==="bits")continue;let u=d[l];typeof u=="boolean"?u=null:u==="1"?u=!0:u==="0"?u=!1:typeof u=="string"&&(u=h.unescapeIRC(u)),d[l]=u}if(r.prefix===null)switch(r.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":{const l=new Date;this.currentLatency=(l.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break}default:this.log.warn(`Could not parse message with no prefix:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="tmi.twitch.tv")switch(r.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=r.params[0];break;case"376":{this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{this._isConnected()&&this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer))},h.get(this.opts.connection.timeout,9999))},6e4);let l=h.get(this.opts.options.joinInterval,2e3);l<300&&(l=300);const u=new x(l),T=[...new Set([...this.opts.channels,...this.channels])];this.channels=[];for(let S=0;S<T.length;S++){const E=T[S];u.add(()=>{this._isConnected()&&this.join(E).catch(M=>this.log.error(M))})}u.next();break}case"NOTICE":{const l=[null],u=[o,_,c],T=[_],S=[o,!0],E=[o,!1],M=[u,l],y=[u,T],p=`[${o}] ${c}`;switch(_){case"subs_on":this.log.info(`[${o}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[S,S,l]);break;case"subs_off":this.log.info(`[${o}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[E,E,l]);break;case"emote_only_on":this.log.info(`[${o}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[S,l]);break;case"emote_only_off":this.log.info(`[${o}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[E,l]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${o}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[S,S,l]);break;case"r9k_off":this.log.info(`[${o}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[E,E,l]);break;case"room_mods":{const L=c.split(": "),D=(L.length>1?L[1]:"").toLowerCase().split(", ").filter(G=>G);this.emits(["_promiseMods","mods"],[[null,D],[o,D]]);break}case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[o,[]]]);break;case"vips_success":{c.endsWith(".")&&(c=c.slice(0,-1));const L=c.split(": "),D=(L.length>1?L[1]:"").toLowerCase().split(", ").filter(G=>G);this.emits(["_promiseVips","vips"],[[null,D],[o,D]]);break}case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[o,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(p),this.emits(["notice","_promiseBan"],y);break;case"ban_success":this.log.info(p),this.emits(["notice","_promiseBan"],M);break;case"usage_clear":this.log.info(p),this.emits(["notice","_promiseClear"],y);break;case"usage_mods":this.log.info(p),this.emits(["notice","_promiseMods"],[u,[_,[]]]);break;case"mod_success":this.log.info(p),this.emits(["notice","_promiseMod"],M);break;case"usage_vips":this.log.info(p),this.emits(["notice","_promiseVips"],[u,[_,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(p),this.emits(["notice","_promiseVip"],[u,[_,[]]]);break;case"vip_success":this.log.info(p),this.emits(["notice","_promiseVip"],M);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(p),this.emits(["notice","_promiseMod"],y);break;case"unmod_success":this.log.info(p),this.emits(["notice","_promiseUnmod"],M);break;case"unvip_success":this.log.info(p),this.emits(["notice","_promiseUnvip"],M);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(p),this.emits(["notice","_promiseUnmod"],y);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(p),this.emits(["notice","_promiseUnvip"],y);break;case"color_changed":this.log.info(p),this.emits(["notice","_promiseColor"],M);break;case"usage_color":case"turbo_only_color":this.log.info(p),this.emits(["notice","_promiseColor"],y);break;case"commercial_success":this.log.info(p),this.emits(["notice","_promiseCommercial"],M);break;case"usage_commercial":case"bad_commercial_error":this.log.info(p),this.emits(["notice","_promiseCommercial"],y);break;case"hosts_remaining":{this.log.info(p);const L=isNaN(c[0])?0:parseInt(c[0]);this.emits(["notice","_promiseHost"],[u,[null,~~L]]);break}case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(p),this.emits(["notice","_promiseHost"],[u,[_,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(p),this.emits(["notice","_promiseR9kbeta"],y);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(p),this.emits(["notice","_promiseR9kbetaoff"],y);break;case"timeout_success":this.log.info(p),this.emits(["notice","_promiseTimeout"],M);break;case"delete_message_success":this.log.info(`[${o} ${c}]`),this.emits(["notice","_promiseDeletemessage"],M);break;case"already_subs_off":case"usage_subs_off":this.log.info(p),this.emits(["notice","_promiseSubscribersoff"],y);break;case"already_subs_on":case"usage_subs_on":this.log.info(p),this.emits(["notice","_promiseSubscribers"],y);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(p),this.emits(["notice","_promiseEmoteonlyoff"],y);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(p),this.emits(["notice","_promiseEmoteonly"],y);break;case"usage_slow_on":this.log.info(p),this.emits(["notice","_promiseSlow"],y);break;case"usage_slow_off":this.log.info(p),this.emits(["notice","_promiseSlowoff"],y);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(p),this.emits(["notice","_promiseTimeout"],y);break;case"untimeout_success":case"unban_success":this.log.info(p),this.emits(["notice","_promiseUnban"],M);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(p),this.emits(["notice","_promiseUnban"],y);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(p),this.emits(["notice","_promiseDeletemessage"],y);break;case"usage_unhost":case"not_hosting":this.log.info(p),this.emits(["notice","_promiseUnhost"],y);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(p),this.emits(["notice","_promiseWhisper"],y);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(p),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[u,[_,o]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(p),this.emit("automod",o,_,c);break;case"unrecognized_cmd":this.log.info(p),this.emit("notice",o,_,c);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(p),this.emit("notice",o,_,c);break;case"host_on":case"host_off":break;default:c.includes("Login unsuccessful")||c.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=c,this.log.error(this.reason),this.ws.close()):c.includes("Error logging in")||c.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=c,this.log.error(this.reason),this.ws.close()):c.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`),this.emit("notice",o,_,c));break}break}case"USERNOTICE":{const l=d["display-name"]||d.login,u=d["msg-param-sub-plan"]||"",T=h.unescapeIRC(h.get(d["msg-param-sub-plan-name"],""))||null,E={prime:u.includes("Prime"),plan:u,planName:T},M=~~(d["msg-param-streak-months"]||0),y=d["msg-param-recipient-display-name"]||d["msg-param-recipient-user-name"],p=~~d["msg-param-mass-gift-count"];switch(d["message-type"]=_,_){case"resub":this.emits(["resub","subanniversary"],[[o,l,M,c,d,E]]);break;case"sub":this.emits(["subscription","sub"],[[o,l,E,c,d]]);break;case"subgift":this.emit("subgift",o,l,M,y,E,d);break;case"anonsubgift":this.emit("anonsubgift",o,M,y,E,d);break;case"submysterygift":this.emit("submysterygift",o,l,p,E,d);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",o,p,E,d);break;case"primepaidupgrade":this.emit("primepaidupgrade",o,l,E,d);break;case"giftpaidupgrade":{const L=d["msg-param-sender-name"]||d["msg-param-sender-login"];this.emit("giftpaidupgrade",o,l,L,d);break}case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",o,l,d);break;case"raid":{const L=d["msg-param-displayName"]||d["msg-param-login"],D=+d["msg-param-viewerCount"];this.emit("raided",o,L,D,d);break}case"ritual":{const L=d["msg-param-ritual-name"];switch(L){case"new_chatter":this.emit("newchatter",o,l,d,c);break;default:this.emit("ritual",L,o,l,d,c);break}break}default:this.emit("usernotice",_,o,d,c);break}break}case"HOSTTARGET":{const l=c.split(" "),u=~~l[1]||0;l[0]==="-"?(this.log.info(`[${o}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[o,u],[null]])):(this.log.info(`[${o}] Now hosting ${l[0]} for ${u} viewer(s).`),this.emit("hosting",o,l[0],u));break}case"CLEARCHAT":if(r.params.length>1){const l=h.get(r.tags["ban-duration"],null);l===null?(this.log.info(`[${o}] ${c} has been banned.`),this.emit("ban",o,c,null,r.tags)):(this.log.info(`[${o}] ${c} has been timed out for ${l} seconds.`),this.emit("timeout",o,c,null,~~l,r.tags))}else this.log.info(`[${o}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[o],[null]]);break;case"CLEARMSG":if(r.params.length>1){const l=c,u=d.login;d["message-type"]="messagedeleted",this.log.info(`[${o}] ${u}'s message has been deleted.`),this.emit("messagedeleted",o,u,l,d)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect().catch(l=>this.log.error(l)),setTimeout(()=>this.connect().catch(l=>this.log.error(l)),this.reconnectTimer);break;case"USERSTATE":r.tags.username=this.username,r.tags["user-type"]==="mod"&&(this.moderators[o]||(this.moderators[o]=[]),this.moderators[o].includes(this.username)||this.moderators[o].push(this.username)),!h.isJustinfan(this.getUsername())&&!this.userstate[o]&&(this.userstate[o]=d,this.lastJoined=o,this.channels.push(o),this.log.info(`Joined ${o}`),this.emit("join",o,h.username(this.getUsername()),!0)),r.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(r.tags["emote-sets"]),this.userstate[o]=d;break;case"GLOBALUSERSTATE":this.globaluserstate=d,this.emit("globaluserstate",d),typeof r.tags["emote-sets"]<"u"&&this._updateEmoteset(r.tags["emote-sets"]);break;case"ROOMSTATE":if(h.channel(this.lastJoined)===o&&this.emit("_promiseJoin",null,o),r.tags.channel=o,this.emit("roomstate",o,r.tags),!h.hasOwn(r.tags,"subs-only")){if(h.hasOwn(r.tags,"slow"))if(typeof r.tags.slow=="boolean"&&!r.tags.slow){const l=[o,!1,0];this.log.info(`[${o}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[l,l,[null]])}else{const l=~~r.tags.slow,u=[o,!0,l];this.log.info(`[${o}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[u,u,[null]])}if(h.hasOwn(r.tags,"followers-only"))if(r.tags["followers-only"]==="-1"){const l=[o,!1,0];this.log.info(`[${o}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[l,l,[null]])}else{const l=~~r.tags["followers-only"],u=[o,!0,l];this.log.info(`[${o}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[u,u,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="jtv")switch(r.command){case"MODE":c==="+o"?(this.moderators[o]||(this.moderators[o]=[]),this.moderators[o].includes(r.params[2])||this.moderators[o].push(r.params[2]),this.emit("mod",o,r.params[2])):c==="-o"&&(this.moderators[o]||(this.moderators[o]=[]),this.moderators[o].filter(l=>l!==r.params[2]),this.emit("unmod",o,r.params[2]));break;default:this.log.warn(`Could not parse message from jtv:
${JSON.stringify(r,null,4)}`);break}else switch(r.command){case"353":this.emit("names",r.params[2],r.params[3].split(" "));break;case"366":break;case"JOIN":{const l=r.prefix.split("!")[0];h.isJustinfan(this.getUsername())&&this.username===l&&(this.lastJoined=o,this.channels.push(o),this.log.info(`Joined ${o}`),this.emit("join",o,l,!0)),this.username!==l&&this.emit("join",o,l,!1);break}case"PART":{let l=!1;const u=r.prefix.split("!")[0];if(this.username===u){l=!0,this.userstate[o]&&delete this.userstate[o];let T=this.channels.indexOf(o);T!==-1&&this.channels.splice(T,1),T=this.opts.channels.indexOf(o),T!==-1&&this.opts.channels.splice(T,1),this.log.info(`Left ${o}`),this.emit("_promisePart",null)}this.emit("part",o,u,l);break}case"WHISPER":{const l=r.prefix.split("!")[0];this.log.info(`[WHISPER] <${l}>: ${c}`),h.hasOwn(r.tags,"username")||(r.tags.username=l),r.tags["message-type"]="whisper";const u=h.channel(r.tags.username);this.emits(["whisper","message"],[[u,r.tags,c,!1]]);break}case"PRIVMSG":if(r.tags.username=r.prefix.split("!")[0],r.tags.username==="jtv"){const l=h.username(c.split(" ")[0]),u=c.includes("auto");if(c.includes("hosting you for")){const T=h.extractNumber(c);this.emit("hosted",o,l,T,u)}else c.includes("hosting you")&&this.emit("hosted",o,l,0,u)}else{const l=h.get(this.opts.options.messagesLogLevel,"info"),u=h.actionMessage(c);if(r.tags["message-type"]=u?"action":"chat",c=u?u[1]:c,h.hasOwn(r.tags,"bits"))this.emit("cheer",o,r.tags,c);else{if(h.hasOwn(r.tags,"msg-id")){if(r.tags["msg-id"]==="highlighted-message"){const T=r.tags["msg-id"];this.emit("redeem",o,r.tags.username,T,r.tags,c)}else if(r.tags["msg-id"]==="skip-subs-mode-message"){const T=r.tags["msg-id"];this.emit("redeem",o,r.tags.username,T,r.tags,c)}}else if(h.hasOwn(r.tags,"custom-reward-id")){const T=r.tags["custom-reward-id"];this.emit("redeem",o,r.tags.username,T,r.tags,c)}u?(this.log[l](`[${o}] *<${r.tags.username}>: ${c}`),this.emits(["action","message"],[[o,r.tags,c,!1]])):(this.log[l](`[${o}] <${r.tags.username}>: ${c}`),this.emits(["chat","message"],[[o,r.tags,c,!1]]))}}break;default:this.log.warn(`Could not parse message:
${JSON.stringify(r,null,4)}`);break}},v.prototype.connect=function(){return new Promise((r,o)=>{this.server=h.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=h.get(this.opts.connection.port,80),this.secure&&(this.port=443),this.port===443&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",c=>{c?o(c):r([this.server,~~this.port])})})},v.prototype._openConnection=function(){const r=`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,o={};"agent"in this.opts.connection&&(o.agent=this.opts.connection.agent),this.ws=new s(r,"irc",o),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},v.prototype._onOpen=function(){this._isConnected()&&(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=h.get(this.opts.identity.username,h.justinfan()),this._getToken().then(r=>{const o=h.password(r);this.log.info("Sending authentication to server.."),this.emit("logon");let c="twitch.tv/tags twitch.tv/commands";this._skipMembership||(c+=" twitch.tv/membership"),this.ws.send("CAP REQ :"+c),o?this.ws.send(`PASS ${o}`):h.isJustinfan(this.username)&&this.ws.send("PASS SCHMOOPIIE"),this.ws.send(`NICK ${this.username}`)}).catch(r=>{this.emits(["_promiseConnect","disconnected"],[[r],["Could not get a token."]])}))},v.prototype._getToken=function(){const r=this.opts.identity.password;let o;return typeof r=="function"?(o=r(),o instanceof Promise?o:Promise.resolve(o)):Promise.resolve(r)},v.prototype._onMessage=function(r){r.data.trim().split(`\r
`).forEach(c=>{const _=b.msg(c);_&&this.handleMessage(_)})},v.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer)),this.ws=null},v.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer))),this.ws=null},v.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},v.prototype._sendCommand=function(r,o,c,_){return new Promise((d,l)=>{if(this._isConnected())(r===null||typeof r=="number")&&(r===null&&(r=this._getPromiseDelay()),h.promiseDelay(r).then(()=>l("No response from Twitch.")));else return l("Not connected to server.");if(o!==null){const u=h.channel(o);this.log.info(`[${u}] Executing command: ${c}`),this.ws.send(`PRIVMSG ${u} :${c}`)}else this.log.info(`Executing command: ${c}`),this.ws.send(c);typeof _=="function"?_(d,l):d()})},v.prototype._sendMessage=function(r,o,c,_){return new Promise((d,l)=>{if(this._isConnected()){if(h.isJustinfan(this.getUsername()))return l("Cannot send anonymous messages.")}else return l("Not connected to server.");const u=h.channel(o);if(this.userstate[u]||(this.userstate[u]={}),c.length>=500){const y=h.splitLine(c,500);c=y[0],setTimeout(()=>{this._sendMessage(r,o,y[1],()=>{})},350)}this.ws.send(`PRIVMSG ${u} :${c}`);const T={};Object.keys(this.emotesets).forEach(y=>this.emotesets[y].forEach(p=>(h.isRegex(p.code)?b.emoteRegex:b.emoteString)(c,p.code,p.id,T)));const S=Object.assign(this.userstate[u],b.emotes({emotes:b.transformEmotes(T)||null})),E=h.get(this.opts.options.messagesLogLevel,"info"),M=h.actionMessage(c);M?(S["message-type"]="action",this.log[E](`[${u}] *<${this.getUsername()}>: ${M[1]}`),this.emits(["action","message"],[[u,S,M[1],!0]])):(S["message-type"]="chat",this.log[E](`[${u}] <${this.getUsername()}>: ${c}`),this.emits(["chat","message"],[[u,S,c,!0]])),typeof _=="function"?_(d,l):d()})},v.prototype._updateEmoteset=function(r){let o=r!==void 0;if(o&&(r===this.emotes?o=!1:this.emotes=r),this._skipUpdatingEmotesets){o&&this.emit("emotesets",r,{});return}const c=()=>{this._updateEmotesetsTimerDelay>0&&(clearTimeout(this._updateEmotesetsTimer),this._updateEmotesetsTimer=setTimeout(()=>this._updateEmoteset(r),this._updateEmotesetsTimerDelay))};this._getToken().then(_=>{const d=`https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=${r}`,l={};return"fetchAgent"in this.opts.connection&&(l.agent=this.opts.connection.fetchAgent),i(d,{...l,headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${h.token(_)}`,"Client-ID":this.clientId}})}).then(_=>_.json()).then(_=>{this.emotesets=_.emoticon_sets||{},this.emit("emotesets",r,this.emotesets),c()}).catch(()=>c())},v.prototype.getUsername=function(){return this.username},v.prototype.getOptions=function(){return this.opts},v.prototype.getChannels=function(){return this.channels},v.prototype.isMod=function(r,o){const c=h.channel(r);return this.moderators[c]||(this.moderators[c]=[]),this.moderators[c].includes(h.username(o))},v.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},v.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},v.prototype.disconnect=function(){return new Promise((r,o)=>{this.ws!==null&&this.ws.readyState!==3?(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>r([this.server,~~this.port]))):(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),o("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},v.prototype.off=v.prototype.removeListener,e.exports&&(e.exports=v),typeof window<"u"&&(window.tmi={client:v,Client:v})})(pe);var ht=pe.exports;const fe=ht;var ut={client:fe,Client:fe};const mt=Ge(ut);class ft{constructor(t){N(this,"client");N(this,"timer",null);this.client=new mt.Client({channels:t}),this.client.connect(),this.setupListeners()}setupListeners(){this.client.on("message",(t,s,i,n)=>{this.handleMessage(t,s,i,n)})}handleMessage(t,s,i,n){var x,h;if(n||!(((x=s==null?void 0:s.badges)==null?void 0:x.broadcaster)==="1")||!i.includes("!pomo"))return;const m=i.split(" "),g=m[1]||"",b=parseInt(m[2],10)||0;!g.includes("stop")&&!g.includes("start")||(g==="start"?(this.timer=new Ye(b,0),this.timer.start()):g==="stop"&&((h=this.timer)==null||h.stop()))}}document.addEventListener("DOMContentLoaded",()=>new ft(["metalandcoffee_"]));
